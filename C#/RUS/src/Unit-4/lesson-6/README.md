# Урок 6: Как родительские акторы наблюдают за дочерними акторами.

Одной из особенностей системы акторов является то, что система обладает отказоустойчивостью и способностью автоматически восстанавливаться после сбоев. Это достигается за счёт родительского контроля, когда родительский актор контролирует состояние своих дочерних акторов.

Родительский контроль заключается в том, что когда актор бросает исключение, первое, что произойдёт, это сам актор и все его дочерние акторы, будут отстранены от обработки сообщений. Затем сообщение об ошибке в дочернем акторе будет передано его родительскому актору.

Далее родительский актор решает, как обрабатывать эту ошибку, а после принятия решения отправляет сообщение дочернему актору, с инструкциями, что делать в данной ситуации. Существует много различных стратегии обработки исключений в дочерних актёрах, к примеру, родительский актор может перезапустить дочерний актор в случае возникновения в нем ошибки.

Также следует иметь в виду. В том случае, если у дочернего актора, есть свои собственные дочерние акторы, то сообщение о перезапуске также поступит и к его дочерним акторам, и так далее вниз по иерархии акторов. 

![](images/4_6_1.png)

Итак, давайте рассмотрим различные стратегии обработки ошибок, которые может предложить родительский актор для своих дочерних акторов. 

#### Возобновления работы.

Первая стратегия, которую может выбрать родительский актор, это сказать своему дочернему актору, чтобы он попытался возобновить обработку сообщений. То есть то исключение, которое привело к возникновению ошибки, в дочернем акторе будет, по сути, просто проигнорировано. Но мы можем сохранить это сообщение об ошибке в журнале, для дальнейшего анализа, с целью недопущения подобных ошибок в будущем. Также стоит иметь ввиду что при возобновлении работы актора, его внутреннее состояние сохраняется. Давайте вернёмся к нашему примеру с фильмами. Так если ошибка возникнет в акторе который отвечает за подсчёт количества воспроизведения фильмов при возобновлении его работы он будет помнить все ранее воспроизведённые фильмы. Когда мы возобновляем работу дочернего актора, который сгенерировал ошибку, все его дочерние акторы также будут возобновлены.  

#### Перезагрузка.

Если родительский актор решает, что состояние дочернего актора повреждено, и мы больше не сможем возобновить его работу, в этом случае мы должны перезапустить его с нуля. Когда дочерний актор перезапускается, его внутреннее состояние теряется. Если мы вернёмся к нашему примеру с актором для подсчёта количества просмотров фильма, то при его перезагрузке он потеряет все ранее подсчитанные фильмы и количество воспроизведений для фильмов начнёт отсчитываться от нуля. Когда мы перезапускаем актор, который генерировал исключение, он также перезапустит все свои дочерние акторы. Также стоит иметь в виду что, когда мы перезапустим наш актор, он потеряет своё внутреннее состояние, но не потеряет ни одного из оставшихся сообщений, которые находятся в его почтовом ящике. Когда он перезагрузится, он продолжит обработку со следующего сообщения. 

#### Полная остановка.

Также родительский актор может полностью остановить дочерний актор. Что в свою очередь, приведёт к полной остановке всех дочерних акторов нашего актора.

#### Делегирование принятия решения на вышестоящий уровень.

И, наконец, родительский актор может выбрать делегирование принятия решения на вышестоящий уровень, то есть передать решение о том, что делать, на один уровень вверх по иерархии родитель-потомок. Если родительский актор решает перевести принятие решения на более высокий уровень, то сам родительский актор будет приостановлен. Когда родительский актор будет приостановлен, все его дочерние акторы в дополнение к тому, который уже сгенерировал исключение, также будут приостановлены.

