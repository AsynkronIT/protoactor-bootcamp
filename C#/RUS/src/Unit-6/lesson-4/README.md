# Урок 4: EventStream.

В платформе Proto.Actor поддержка каналов «издатель/подписчик» реализуется классом EventStream. Каждая система акторов ActorSystem имеет такой объект, доступный любому актору (как system.EventStream). EventStream можно считать диспетчером нескольких каналов «издатель/подписчик», потому что любой актор может подписаться на сообщения определенного типа, и когда какой-то другой актор опубликует сообщение этого типа, подписчик получит его.

Подписка может быть выполнена в любом месте в системе, где доступны ссылки на EventStream. Что бы подписать актор на получение сообщений, нужно вызвать метод Subscribe класса EventStream. И сохранить возвращаемое им значение. В данном значении содержится полное описание только что сделанной подписки.

```c#
orderSubscription = Cluster.System.EventStream.Subscribe<Order>(msg => Console.WriteLine("message received"))
```

Когда необходимость в подписке отпадёт, например когда завершится подарочная акция, можно воспользоваться методом `Unsubscribe`. В данном примере мы аннулировали подписку компонента GiftModule, и после вызова этого метода актор перестанет получать сообщения Order.

```c#
orderSubscription.Unsubscribe()
```

Это все, что требуется, чтобы подписать компонент GiftModule на по лучение сообщений Order. После вызова метода `Subscribe` компонент GiftModule будет получать все сообщения Order, публикуемые в EventStream. Этот метод можно вызвать для любого актора, заинтересованного в получении сообщений Order. А когда актор должен получать сообщения разных типов, метод `Subscribe` можно вызвать несколько раз с разными типами сообщений.

Публикация сообщений в EventStream выполняется так же просто; доста­точно вызвать метод Publish, 

```c#
system.EventStream.Publish(msg);
```

После этого сооб­щение msg будет передано всем акторам-подписчикам. По сути, этим и исчерпывается реализация каналов вида «издатель/подписчик» в Proto.Actor.

В Proto.Actor имеется возможность подписаться сразу на несколько типов событий. Например, наш компонент GiftModule также должен обрабатывать сообщения об отмене заказа, потому что в этом случае подарок не должен отправляться. Для этого компонент GiftModule должен подписаться в EventStream на получение сообщений Order и Cancel. Обе подписки действуют независимо, то есть после аннулирования подписки на сообщения Orders подписка на сообщения Cancel продолжит действовать, и эти сообщения будут доставляться.

Ранее мы уже упоминали о преимуществах слабой связи между отправителем и получателями, а также динамической? природе канала «издатель/подписчик». А так как EventStream доступен всем акторам, он также является отличным решением для случаев, когда все сообщения со всех концов локальнои? системы должны стекаться в один или несколько акторов. Ярким примерам может служить журналирование. Все журналируемые сообщения должны стекаться в одну точку и записываться в файл журнала.